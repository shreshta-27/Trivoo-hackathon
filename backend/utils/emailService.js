import nodemailer from 'nodemailer';import dotenv from 'dotenv';dotenv.config();const sendMockFallback = (type, to, subject) => {    const mockId = `MOCK-${Date.now()}-${Math.floor(Math.random() * 10000)}`;    const randomMsgs = [        "Simulated delivery to virtual inbox.",        "Fallback activated: Email suppressed but logged.",        "Mock SMTP Server accepted message.",        "Bypassing real credentials for resilience.",        "Email content preserved in logs."    ];    const randomMsg = randomMsgs[Math.floor(Math.random() * randomMsgs.length)];    console.warn(`\n‚ö†Ô∏è  [EMAIL FALLBACK] Real sending failed. Switching to MOCK MODE.`);    console.log(`üì®  [MOCK EMAIL] Type: ${type}`);    console.log(`    To: ${to}`);    console.log(`    Subject: ${subject}`);    console.log(`    Mock ID: ${mockId}`);    console.log(`    Note: ${randomMsg}\n`);    return { success: true, messageId: mockId, mocked: true };};const createTransporter = () => {    return nodemailer.createTransport({        host: 'smtp.gmail.com',        port: 587,        secure: false,        auth: {            user: process.env.EMAIL_USER,            pass: process.env.EMAIL_PASS        },        tls: {            rejectUnauthorized: false        }    });};export const sendWelcomeEmail = async (userEmail, userName) => {    const transporter = createTransporter();    const mailOptions = {        from: `"Trivoo Team" <${process.env.EMAIL_USER}>`,        to: userEmail,        subject: 'üéâ Welcome to Trivoo - Your Account is Ready!',        html: `            <!DOCTYPE html>            <html>            <head>                <style>                    body {                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;                        line-height: 1.6;                        color: #333;                        max-width: 600px;                        margin: 0 auto;                        padding: 20px;                        background-color: #f4f4f4;                    }                    .container {                        background: white;                        border-radius: 10px;                        overflow: hidden;                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);                    }                    .header {                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);                        color: white;                        padding: 40px 30px;                        text-align: center;                    }                    .header h1 {                        margin: 0;                        font-size: 32px;                    }                    .content {                        padding: 40px 30px;                    }                    .greeting {                        font-size: 18px;                        margin-bottom: 20px;                    }                    .message {                        margin: 20px 0;                        font-size: 16px;                    }                    .features {                        background: #f8f9fa;                        padding: 20px;                        border-radius: 8px;                        margin: 25px 0;                    }                    .features h3 {                        color: #667eea;                        margin-top: 0;                    }                    .features ul {                        list-style: none;                        padding: 0;                    }                    .features li {                        padding: 8px 0;                        padding-left: 25px;                        position: relative;                    }                    .features li:before {                        content: "üöÄ";                        position: absolute;                        left: 0;                    }                    .footer {                        text-align: center;                        padding: 20px 30px;                        background: #f8f9fa;                        color: #666;                        font-size: 14px;                    }                    .signature {                        margin-top: 30px;                        font-weight: bold;                        color: #667eea;                    }                </style>            </head>            <body>                <div class="container">                    <div class="header">                        <h1>üéâ Welcome to Trivoo!</h1>                    </div>                    <div class="content">                        <p class="greeting">Hi <strong>${userName}</strong>,</p>                        <p class="message">                            Welcome to <strong>Trivoo</strong>! üéâ<br>                            We're excited to have you on board.                        </p>                        <p class="message">                            Your account has been successfully created, and you can now start exploring everything Trivoo has to offer ‚Äî from smart learning experiences to personalized insights designed just for you.                        </p>                        <div class="features">                            <h3>üöÄ What you can do next:</h3>                            <ul>                                <li>Explore your dashboard</li>                                <li>Start your first learning session</li>                                <li>Track your progress with AI-powered insights</li>                            </ul>                        </div>                        <p class="message">                            If you have any questions or need help, feel free to reply to this email ‚Äî we're always here for you.                        </p>                        <p class="message">                            Happy learning!                        </p>                        <p class="signature">Team Trivoo üíô</p>                    </div>                    <div class="footer">                        <p>If you didn't create this account, please ignore this email.</p>                    </div>                </div>            </body>            </html>        `    };    try {        console.log('üîµ Attempting to send email...');        const info = await transporter.sendMail(mailOptions);        console.log('üîµ‚úÖ WELCOME EMAIL SENT SUCCESSFULLY!');        console.log('üîµ Message ID:', info.messageId);        console.log('üîµ Response:', info.response);        return { success: true, messageId: info.messageId };    } catch (error) {        console.error('üîµ‚ùå WELCOME EMAIL FAILED:', error.message);        return sendMockFallback('WELCOME', userEmail, mailOptions.subject);    }};export const sendLoginEmail = async (userEmail, userName) => {    const transporter = createTransporter();    const mailOptions = {        from: `"Trivoo Team" <${process.env.EMAIL_USER}>`,        to: userEmail,        subject: 'üëã Welcome Back to Trivoo!',        html: `            <!DOCTYPE html>            <html>            <head>                <style>                    body {                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;                        line-height: 1.6;                        color: #333;                        max-width: 600px;                        margin: 0 auto;                        padding: 20px;                        background-color: #f4f4f4;                    }                    .container {                        background: white;                        border-radius: 10px;                        overflow: hidden;                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);                    }                    .header {                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);                        color: white;                        padding: 40px 30px;                        text-align: center;                    }                    .header h1 {                        margin: 0;                        font-size: 32px;                    }                    .content {                        padding: 40px 30px;                    }                    .greeting {                        font-size: 18px;                        margin-bottom: 20px;                    }                    .message {                        margin: 20px 0;                        font-size: 16px;                    }                    .features {                        background: #f8f9fa;                        padding: 20px;                        border-radius: 8px;                        margin: 25px 0;                    }                    .features h3 {                        color: #667eea;                        margin-top: 0;                    }                    .features ul {                        list-style: none;                        padding: 0;                    }                    .features li {                        padding: 8px 0;                        padding-left: 25px;                        position: relative;                    }                    .features li:before {                        content: "üöÄ";                        position: absolute;                        left: 0;                    }                    .footer {                        text-align: center;                        padding: 20px 30px;                        background: #f8f9fa;                        color: #666;                        font-size: 14px;                    }                    .signature {                        margin-top: 30px;                        font-weight: bold;                        color: #667eea;                    }                </style>            </head>            <body>                <div class="container">                    <div class="header">                        <h1>üëã Welcome Back to Trivoo!</h1>                    </div>                    <div class="content">                        <p class="greeting">Hi <strong>${userName}</strong>,</p>                        <p class="message">                            Welcome back to <strong>Trivoo</strong>! üéâ<br>                            We're excited to see you again.                        </p>                        <p class="message">                            You've successfully logged in, and you can continue exploring everything Trivoo has to offer ‚Äî from smart learning experiences to personalized insights designed just for you.                        </p>                        <div class="features">                            <h3>üöÄ What you can do next:</h3>                            <ul>                                <li>Explore your dashboard</li>                                <li>Continue your learning session</li>                                <li>Track your progress with AI-powered insights</li>                            </ul>                        </div>                        <p class="message">                            If you have any questions or need help, feel free to reply to this email ‚Äî we're always here for you.                        </p>                        <p class="message">                            Happy learning!                        </p>                        <p class="signature">Team Trivoo üíô</p>                    </div>                    <div class="footer">                        <p>If you didn't log in to this account, please contact us immediately.</p>                    </div>                </div>            </body>            </html>        `    };    try {        console.log('üü¢ Attempting to send email...');        const info = await transporter.sendMail(mailOptions);        console.log('üü¢‚úÖ LOGIN EMAIL SENT SUCCESSFULLY!');        console.log('üü¢ Message ID:', info.messageId);        console.log('üü¢ Response:', info.response);        return { success: true, messageId: info.messageId };    } catch (error) {        console.error('üü¢‚ùå LOGIN EMAIL FAILED:', error.message);        return sendMockFallback('LOGIN', userEmail, mailOptions.subject);    }};export const sendAlertEmail = async (to, subject, htmlBody) => {    const transporter = createTransporter();    const mailOptions = {        from: `"Trivoo Alert System" <${process.env.EMAIL_USER}>`,        to: to,        subject: subject,        html: htmlBody    };    try {        if (!process.env.EMAIL_USER || !process.env.EMAIL_PASS) {            console.warn('‚ö†Ô∏è Email credentials missing in .env. Skipping email send.');            return { success: true, mocked: true };        }        console.log(`üö® Attempting to send ALERT email to ${to}...`);        const info = await transporter.sendMail(mailOptions);        console.log('üö®‚úÖ ALERT EMAIL SENT SUCCESSFULLY!');        console.log('üö® Message ID:', info.messageId);        return { success: true, messageId: info.messageId };    } catch (error) {        console.error('üö®‚ùå ALERT EMAIL FAILED:', error.message);        return sendMockFallback('ALERT', to, subject);    }};export default { sendWelcomeEmail, sendLoginEmail, sendAlertEmail };